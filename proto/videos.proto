syntax = "proto3";

package watchtower;

import "comments.proto";
import "messages.proto";

option go_package = "videoapp/internal/proto";

service Videos {
  rpc CreateUpload(CreateUploadRequest) returns (CreateUploadResponse);
  rpc Create(VideosCreateRequest) returns (VideosCreateResponse);
  rpc GetUserVideos(GetUserVideosRequest) returns (GetUserVideosResponse);
  rpc Get(GetVideoRequest) returns (GetVideoResponse);
  rpc GetStage(VideosGetStageRequest) returns (VideosGetStageResponse);
  rpc GetStages(VideosGetStagesRequest) returns (VideosGetStagesResponse);
  rpc Delete(DeleteVideoRequest) returns (DeleteVideoResponse);

  rpc CreateComment(CreateCommentRequest) returns (Comment);
  rpc ListComments(ListCommentsRequest) returns (ListCommentsResponse);
  rpc DeleteComment(DeleteCommentRequest) returns (Empty);
  rpc EditComment(EditCommentRequest) returns (Empty);
}

message VideosGetStageRequest {
  string session = 1;
  int64 id = 2;
}
message VideosGetStageResponse {
  Stage stage = 1;
  int64 upload_id = 2;
  string authorization_payload = 3;
  string authorization_signature = 4;
}
message VideosGetStagesRequest {
  repeated int64 ids = 1;
}
message VideosGetStagesResponse {
  string result = 1;
}
message CreateUploadRequest {
  string session = 1;
}
message CreateUploadResponse {
  int64 id = 1 [jstype = JS_STRING];
  string url = 2;
  map<string, string> form_data = 3;
}
message VideosCreateRequest {
  string session = 1;
  int64 upload_id = 2 [jstype = JS_STRING];
  int64 thumbnail_id = 3 [jstype = JS_STRING];
  string title = 5;
  string description = 6;
  Visibility visibility = 7;
}
message VideosCreateResponse {
  int64 id = 1;
}
message GetUserVideosRequest {
  int64 id = 1;
  string session = 2;
}

message GetUserVideosResponse {
  repeated GetUserVideosResponseVideo videos = 1;
}
message GetUserVideosResponseVideo {
  int64 id = 1 [jstype = JS_STRING];
  string title = 2;
  Visibility visibility = 3;
  int64 created_at = 4;
  int64 thumbnail_id = 5 [jstype = JS_STRING];
  Stage stage = 6;
}

message DeleteVideoRequest {
  string session = 1;
  int64 video_id = 2;
}
message DeleteVideoResponse {}

service Thumbnails {
  rpc CreateUpload(CreateUploadRequest) returns (CreateUploadResponse);
  rpc Process(ThumbnailsProcessRequest) returns (ThumbnailsProcessResponse);
}

message ThumbnailsProcessRequest {
  string session = 1;
  int64 id = 2;
}
message ThumbnailsProcessResponse {}

message GetVideoRequest {
  string session = 1;
  int64 id = 2;
}
message GetVideoResponse {
  int64 id = 1;
  string title = 2;
  Visibility visibility = 3;
  int64 created_at = 4;
  int64 thumbnail_id = 5;
  int64 upload_id = 6;
  int64 user_id = 7;
  Stage stage = 8;
  string authorization_payload = 9;
  string authorization_signature = 10;
  int64 likes = 11;
  int64 dislikes = 12;
  int32 user_reaction = 13;
  int64 comments = 14;
}
enum Visibility {
  Public = 0;
  Unlisted = 1;
  Private = 2;
}
enum Stage {
  NotUploaded = 0;
  AwaitingProcessing = 1;
  Processing = 2;
  Processed = 3;
  FlaggedForNudity = 4;
}
